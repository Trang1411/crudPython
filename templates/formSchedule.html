<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Form Schedule</title>
</head>
<body>
<div>
    <h1>Form đăng ký</h1>
    <form action="{{ url_for('form_schedule')}}" method="POST" style="text-align: center">
        <div>
            <label >Tên dịch vụ</label>
            <span>
            <input id="service_name" name="service_name" type="text" placeholder="Nhập tên dịch vụ"
                   style="width: 380px"/>
          </span>
            <label> Config </label>
            <span>
            <textarea name="config_file" id="config_file" rows="30" cols="50" placeholder="Nhập file config"></textarea>
          </span>
        </div>
        <div>
            <select id="selectTag" for="time_set">
                <option value="EVD" name="EVD"> Thời gian thực thi hàng ngày (HH:mm:ss)</option>
                <option value="EVT" name="EVT">Khoảng thời gian thực thi(s)</option>
            </select>
            <input type="text" id="time_set" name="time_set" class="invalid "/>
            <input id="time_set_hidden" name="time_set_hidden" value='{"EVT":[], "EVD":[]}' hidden="hidden"/>
            <span>
            <input type="button" value="+" onclick="add()"/>
          </span>
        </div>
        <div style="padding-top: 30px;">
            <button type="submit" onclick="add()">Lưu</button>
        </div>
    </form>
    <div>
        <label>
            <table id="dataTable" style="text-align: left;">
                <tr>
                    <th></th>
                    <th></th>
                </tr>
            </table>
        </label>

    </div>
</div>
</body>
</html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    function add() {
      // lấy giá trị của select
      var select_value = document.getElementById("selectTag").value;

      // Lấy data đã lưu trước
      time_set_hidden = document.getElementById("time_set_hidden").value;
      time_set_hidden_value = JSON.parse(time_set_hidden);

      var input_time_set = document.getElementById("time_set");
      // lấy giá trị của input
      var time_set = document.getElementById("time_set").value;

      // check validate type input time_set
      if (time_set !== "") {

        time_set_hidden_value[select_value].push(time_set);
      }
      document.getElementById("time_set_hidden").value = JSON.stringify(
        time_set_hidden_value
      );
      document.getElementById("time_set").value = "";

      var dataTable = document.getElementById("dataTable");

      // Clear existing rows
      dataTable.innerHTML = "<tr><th></th><th></th><th></th></tr>";

      // Thêm dòng mới trong bảng sau khi click "+"
      for (var label in time_set_hidden_value) {
        for (var i = 0; i < time_set_hidden_value[label].length; i++) {
          var row = dataTable.insertRow();
          var cell1 = row.insertCell(0);
          var cell2 = row.insertCell(1);
          var cell3 = row.insertCell(2);
          if(label === "EVD"){
            cell1.innerHTML = "Thời gian thực thi trong ngày (HH:mm:ss)";
          }else{
             cell1.innerHTML = "Khoảng thời gian giữa 2 lần thực thi (s)";
          }
          cell2.innerHTML = time_set_hidden_value[label][i];

          // Thêm nút xóa ở mỗi dòng trong bảng
          var deleteButton = document.createElement("button");
          deleteButton.innerHTML = "-";
          deleteButton.onclick = function () {
            deleteRow(this);
          };
          cell3.appendChild(deleteButton);
        }
      }
    }
    function deleteRow(button) {
      var row = button.parentNode.parentNode;
      var label = row.cells[0].innerHTML;
      var value = row.cells[1].innerHTML;

      // Xóa dòng trong bảng khi click "-"
      row.parentNode.removeChild(row);

      // Xóa dữ liệu trong time_set_hidden_value khi -
      var index = time_set_hidden_value[label].indexOf(value);
      if (index !== -1) {
        time_set_hidden_value[label].splice(index, 1);
        document.getElementById("time_set_hidden").value = JSON.stringify(
          time_set_hidden_value
        );
      }
    }

    function check_input_format (select_value, time_set_value) {
        var input_time_set = document.getElementById("time_set");
        input_time_set.addEventListener("change", () => {
            var isHHmm = moment(time_set, "HH:mm");
            var isInteger = !isNaN(time_set) && time_set > 0;
            if ((select_value === "EVD" && !isHHmm.isValid()) || (select_value === "EVT" && !isInteger)) {
                input_time_set.classList.add("invalid");

                // Hiển thị thông báo lỗi
                const errorElement = document.createElement("span");
                errorElement.textContent = "Dữ liệu đầu vào không hợp lệ";
                errorElement.classList.add("error");
                input_time_set.after(errorElement);
            }else {
                // Dữ liệu đầu vào hợp lệ
                input_time_set.classList.remove("invalid");
            }
    }
</script>
<style>
    body {
         padding-top: 50px;
         text-align: center;
         background-color: lightblue;
         color: darkblue;
         width: auto;
         front-size: 18;
         margin: auto;
         padding: auto;
    }
    label {
        display: flex;
        justify-content: center;
        margin: auto;
        padding: auto;
    }

    table{
        vertical-align: middle;
        border-top:1px solid #ccc;
        border-bottom:1px solid #ccc;
        border-collapse:collapse;
        width: 420px;
        margin: 20px;
        padding: 15px;
}
</style>
